//???????ͷ???β
$('#header').load('php/header.php',function(){
  
});

//?????ǰol?ı?l?????ɫ??ı??ɫ ??ǰdiv?ʾ
$('.same').mouseover(function (e) {
  $(this).children('.other_menu').css('display','block');
})
$('.same').mouseout(function (e) {
  $(this).children('.other_menu').css('display','none');
})
$('.same').each(function (i,elem){
  $(this).children('.other_menu').css('top',-i*29-10+'px');
})
/*?رո??Ӳ˵???lose??ť*/
$('.other_menu>p').click(function () {
  $('.other_menu').css('display','none');
})
/*???Ч??*/
/*???????*/
/*????1.:eqѡ?? 2.Ŀ????jq? e.target var $target=$(e.target) 3.:notѡ??
 * Ϊѡ??Ԫ??󶨼???????on('????','??????Ӧ???Χѡ?',function(){}(fn??????????????))
 * ???????????һ???ص??????callback ????????ִ???????Ķ?? ?ص??????hisĬ?ָwindow ?ʹ????this???
 * ??ʹ??????ͬ??????ı?bind(this)*/
var data=[
  {id:'0',img:'/lianshuomai/Public/Home/img/lun1.jpg'},
  {id:'1',img:'/lianshuomai/Public/Home/img/lun2.jpg'}
];
var slider={
  LIWIDTH:0,
  DURATION:1000,
  WAIT:8000,
  timer:null,
  canAuto:true,
  init: function () {
    this.LIWIDTH=parseFloat($('#big_ban').css('width'));
    //????????ݷ???
    this.updateView();
    /*????????л????ͼ*/
    //Ϊ??ŵĸ?Ԫ?????????? ???onð????̳?¼?
    /*ԭ?dom?󶨼??????ķ?????
     * document.addEventListener('scroll')*/
    $('#counts').on('mouseover','li:not(.hover)', function (e) {
      console.log(this);
      //?????ǰ???Դ
      var $target=$(e.target);
      console.log($target.html());
      console.log($target.siblings('.hover').html());
      //??? move????ʵ???????ͼƬ
      this.move($target.html()-$target.siblings('.hover').html());
    }.bind(this));
    //???????ivʱ ??canAuto???false
    //?????Ƴ?divʱ????canAuto???true
    $('#big_ban').hover(
      function(){this.canAuto=false;}.bind(this),
      function(){this.canAuto=true;}.bind(this)
    );
    this.autoMove();
  },
  autoMove: function () {
    this.timer=setTimeout(function() {
      if (this.canAuto) {
        this.move(1);//???һ??
      } else {
        this.autoMove();
      }
    }.bind(this),this.WAIT);
  },
  move:function(n){
    clearTimeout(this.timer);//ֹͣһ??Զ?ʱ?
    this.timer=null;
    var left=parseFloat($('#banner').css('left'));
    if(n<0){
      //??nΪ??? Ϊ?˷??????�???n?????
      $('#banner').stop(true);
      n*=-1;
      //???ֲ??Ϊǰ?û?Ԫ? ???Ҫ??????Ľ??n??Ԫ??????ӵ?????ʼ
      data=data.splice(data.length-n,n).concat(data);
      //???ҳ?
      this.updateView();
      //???banner??eftΪleft-n*this.LIWIDTH
      $('#banner').css('left',left-n*this.LIWIDTH);
      //??????????durationʱ??ڣ???banner??eft???0
      $('#banner').animate({left:'0'},this.DURATION);
      this.autoMove();
    }else{
      $('#banner').stop(true);
      //???????n????ul??????ʵ????Ч??
      $('#banner').animate({left:-n*this.LIWIDTH},this.DURATION,this.endMove.bind(this,n));

      this.autoMove();
    }
  },
  endMove: function (n) {
    //ɾ??????ͷ????Ԫ????ƴ?????
    data=data.concat(data.splice(0,n));
    //???ҳ?
    this.updateView();
    //??????eftΪ0
    $('#banner').css('left',0);
    this.autoMove();
  },
  updateView:function(){
    /*?????????????????ɵ?tml??? ?????̬׷????Ԫ?
     ??????????????÷?ʽ??ƴ??ַ????Ҫ????? ѭ???õ????li*/
    var html='';
    var cou='';
    for(var i=0;i<data.length;i++){
      html+=`<li><img src=${data[i].img}></li>`;
      cou+=`<li></li>`;
    }
    $('#banner').html(html)
      .css('width',this.LIWIDTH*data.length);
    $('#counts').html(cou);
    /*??????????ĵ????Ԫ???ʹ????????????ͼ?????Ӧ ?????ű??Ϊhover*/
    $("#counts>li:eq("+data[0].id+")").addClass('hover').siblings('.hover').removeClass('hover');
  }
}
slider.init();

$('.news>ul>li').mouseover(function(e){
  $(this).children('.news_list').css('display','block');
  $(this).siblings().children('.news_list').css('display','none');
  $(this).addClass('active')
    .siblings('.active').removeClass('active');
})
/*¥???ת*/
var jump={
  UPLEVEL:0,//????????????߽?????ʾ??????ľ??
  DOWNLEVEL:0,
  FHEIGHT:0,//????????߶?
  DURATION:1000,//???????ʱ??
  init: function () {
    this.FHEIGHT = parseFloat($('.style1').css('height')) + parseFloat($('.style1').css('marginBottom'));//style1+f1??arginBottom
    //console.log(this.FHEIGHT);
    //console.log($('.style1'));
    this.UPLEVEL = (innerHeight - this.FHEIGHT) /2;
    console.log(this.UPLEVEL);
    this.DOWNLEVEL = this.UPLEVEL + this.FHEIGHT;
    //console.log(this.DOWNLEVEL);
    //Ϊdocument??croll???Ϊscroll????
    $(document).scroll(this.scroll.bind(this));
  },
  scroll: function () {
    //?Ӧdocument??croll????
    //?????¥??е????????Ԫ?ִ???
    
    $('.banner_main>.light').each(function (i, elem) {
     var totalTop=$(elem).offset().top;
      //console.log($(elem));
      //console.log(totalTop);
      var scrollTop=$("body").scrollTop();
      var innerTop=totalTop-scrollTop+500;
      //console.log(innerTop);
      if(innerTop>this.UPLEVEL&&innerTop<=this.DOWNLEVEL){
        //console.log(i);
        //console.log($(elem));
        $("#left-nav>li:eq("+i+") i").addClass("hover");
      }else{
        $("#left-nav>li:eq("+i+") i").removeClass("hover");
      }
    }.bind(this))
  }
};
jump.init();
$(document).scroll(function(){
  var scrollTop=$('body').scrollTop();
  //console.log(scrollTop);
  if(scrollTop>=100){
    $('#fix').css('opacity','1');
  }else{
    $('#fix').css('opacity','0');
  }
});



$('#left-nav').on('click','a',function(){
  var $target = $(this.hash);
  var targetOffset = $target.offset().top;
  $('html,body').animate({
    scrollTop: targetOffset
  },1000);
});